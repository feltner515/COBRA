# PolygonConcentricCircleMeshGenerator

!syntax description /Mesh/PolygonConcentricCircleMeshGenerator

## Overview

!media reactor/meshgenerators/polycc.png
      style=display: block;margin-left:auto;margin-right:auto;width:40%;
      id=sample
      caption=A typical mesh generated by this `PolygonConcentricCircleMeshGenerator` object.

The `PolygonConcentricCircleMeshGenerator` object generates a 2D mesh for concentric circles with a regular polygon enclosure with or without external ducts. A typical mesh generated by this object is shown in [Figure 1](#sample). Polygons with 3 or more sides (e.g. triangle, square, pentagon, hexagon,...) can be meshed using this object. The central concentric circular regions (termed `rings`) as well as the peripheral polygonal regions (termed `ducts`) are optional (see [Figure 2](#schematic)). The region excluding any rings and ducts is termed the `background` region.

## Geometry Information

The most fundamental geometry parameters that are needed by this object is:

- [!param](/Mesh/PolygonConcentricCircleMeshGenerator/num_sides): the number of sides of the polygon enclosure;
- [!param](/Mesh/PolygonConcentricCircleMeshGenerator/polygon_size_style): the style in which the parameter [!param](/Mesh/PolygonConcentricCircleMeshGenerator/polygon_size) will be given. This parameter can be either `apothem` (center to side distance) or `radius` (center to vertex distance).
- [!param](/Mesh/PolygonConcentricCircleMeshGenerator/polygon_size): the size of the polygon enclosure in terms of either `apothem` or `radius` (selected by another parameter, [!param](/Mesh/PolygonConcentricCircleMeshGenerator/polygon_size_style)

!media reactor/meshgenerators/polygon.png
      style=display: block;margin-left:auto;margin-right:auto;width:40%;
      id=schematic
      caption=A schematic drawing showing the different regions that can be generated by this `PolygonConcentricCircleMeshGenerator` object.

If concentric circle regions are needed, [!param](/Mesh/PolygonConcentricCircleMeshGenerator/ring_radii) must be provided to define the outer radius of each ring. If duct regions are needed, [!param](/Mesh/PolygonConcentricCircleMeshGenerator/duct_sizes) must be provided to define the inner boundary of each duct. Similar to [!param](/Mesh/PolygonConcentricCircleMeshGenerator/polygon_size), [!param](/Mesh/PolygonConcentricCircleMeshGenerator/duct_sizes) can either be apothems or radii of the corresponding ducts, decided by [!param](/Mesh/PolygonConcentricCircleMeshGenerator/duct_sizes_style).

## Mesh Information

The parameters that are needed for meshing can be categorized into azimuthal and radial information, which determine the mesh density.

The azimuthal mesh discretization is controlled by [!param](/Mesh/PolygonConcentricCircleMeshGenerator/num_sectors_per_side), which is a vector that has the same length as [!param](/Mesh/PolygonConcentricCircleMeshGenerator/num_sides). Each element of [!param](/Mesh/PolygonConcentricCircleMeshGenerator/num_sectors_per_side) must be an even integer, which is the number of azimuthal intervals of the corresponding side. The sides are indexed counterclockwise with the upper-right polygon side being the first side as shown in [Figure 2](#schematic).

The radial mesh discretization is controlled by separate parameters for `rings`, `background` and `ducts` regions, which are [!param](/Mesh/PolygonConcentricCircleMeshGenerator/ring_intervals), [!param](/Mesh/PolygonConcentricCircleMeshGenerator/background_intervals), and [!param](/Mesh/PolygonConcentricCircleMeshGenerator/duct_intervals), respectively.

In addition, the radial meshing density of each `rings`, `background` and `ducts` region can be biased by setting corresponding parameters, which are [!param](/Mesh/PolygonConcentricCircleMeshGenerator/ring_radial_biases), [!param](/Mesh/PolygonConcentricCircleMeshGenerator/background_radial_bias), and [!param](/Mesh/PolygonConcentricCircleMeshGenerator/duct_radial_biases), respectively. The bias value should be a positive `Real` type parameter, which is the radial dimension ratio between two radially-neighboring elements (outer to inner).

## Boundary Layers

Aside from the general mesh radial biasing options described above, users can also define boundary layers on each `ring`, `background`, and `duct` regions. For each region, both inner and outer boundary layers are supported (in this case, inner boundary layer refers to a boundary layer on the volume closer to the center of the polygon, and outer boundary layer refers to a boundary layer on the volume further from the center of the polygon; these two volumes are separated by the boundary itself). Each boundary layer requires three key input parameters:

- `boundary layer width`: the radial width of the boundary layer within the region. Note that the summation of the inner and outer boundary layers widths must be smaller than the width of the block layer itself. The specific input parameters are [!param](/Mesh/PolygonConcentricCircleMeshGenerator/ring_inner_boundary_layer_widths), [!param](/Mesh/PolygonConcentricCircleMeshGenerator/ring_outer_boundary_layer_widths), [!param](/Mesh/PolygonConcentricCircleMeshGenerator/background_inner_boundary_layer_width), [!param](/Mesh/PolygonConcentricCircleMeshGenerator/background_outer_boundary_layer_width), [!param](/Mesh/PolygonConcentricCircleMeshGenerator/duct_inner_boundary_layer_widths), and [!param](/Mesh/PolygonConcentricCircleMeshGenerator/duct_outer_boundary_layer_widths).
- `boundary layer intervals`: the number of radial mesh intervals within the boundary layer. The specific parameters are [!param](/Mesh/PolygonConcentricCircleMeshGenerator/ring_inner_boundary_layer_intervals), [!param](/Mesh/PolygonConcentricCircleMeshGenerator/ring_outer_boundary_layer_intervals), [!param](/Mesh/PolygonConcentricCircleMeshGenerator/background_inner_boundary_layer_intervals), [!param](/Mesh/PolygonConcentricCircleMeshGenerator/background_outer_boundary_layer_intervals), [!param](/Mesh/PolygonConcentricCircleMeshGenerator/duct_inner_boundary_layer_intervals), and [!param](/Mesh/PolygonConcentricCircleMeshGenerator/duct_outer_boundary_layer_intervals).
- `boundary layer bias`: the growth factor used for radial mesh biasing for the boundary layer. The specific parameters are [!param](/Mesh/PolygonConcentricCircleMeshGenerator/ring_inner_boundary_layer_biases), [!param](/Mesh/PolygonConcentricCircleMeshGenerator/ring_outer_boundary_layer_biases), [!param](/Mesh/PolygonConcentricCircleMeshGenerator/background_inner_boundary_layer_bias), [!param](/Mesh/PolygonConcentricCircleMeshGenerator/background_outer_boundary_layer_bias), [!param](/Mesh/PolygonConcentricCircleMeshGenerator/duct_inner_boundary_layer_biases), and [!param](/Mesh/PolygonConcentricCircleMeshGenerator/duct_outer_boundary_layer_biases). A bias greater than 1 means the element size increases with increasing radial coordinate, while a bias less than 1 means the element size decreases with increasing radial coordinate. A bias of 1 indicates uniformly spaced elements with increasing radial coordinate.

If there are multiple ring/duct regions in the generated mesh, the boundary layer related parameters of all these regions must be provided together as vectors.

## MeshMeshData Generation

When [!param](/Mesh/PolygonConcentricCircleMeshGenerator/num_sides) is set as 6, the hexagonal meshes produced by `PolygonConcentricCircleMeshGenerator` can be used by [`PatternedHexMeshGenerator`](/PatternedHexMeshGenerator.md) to create patterned meshes. This functionality relies on a series of `MeshMetaData` generated by `PolygonConcentricCircleMeshGenerator`, including:

- `pitch_meta`, type `Real`: Provides the side-to-side distance of the hexagon generated.
- `pattern_pitch_meta`, type `Real`: Similar to `pitch_meta`. This is only used when the mesh produced here is stitched with assembly hexagon meshes generated by `PatternedHexMeshGenerator`.
- `background_intervals_meta`, type `unsigned int`: Makes the value of the input parameter [!param](/Mesh/PolygonConcentricCircleMeshGenerator/background_intervals) available to other mesh generators.
- `node_id_background_meta`, type `dof_id_type`: Records the maximum node id of the background nodes to provide a reference for node modifications.
- `max_radius_meta`, type `Real`: Provides the maximum radius of the ring regions so that `PatternedHexMeshGenerator` does not compromise the circular geometry.
- `num_sectors_per_side_meta`, type `std::vector<unsigned int>`: Makes the value of the input parameter [!param](/Mesh/PolygonConcentricCircleMeshGenerator/num_sectors_per_side) available to other mesh generators.
- `azimuthal_angle_meta`, type `std::vector<Real>`: Contains the sorted azimuthal angles of all the nodes on the external boundary.

## Reporting ID Assignment

`PolygonConcentricCircleMeshGenerator` can assign the reporting IDs for annular rings and sectors, which allows users to manipulate sub-pin level details information such as such as the depletion zone setup.
The option for ring and sector reporting IDs can be turned on by defining the input parameters [!param](/Mesh/PolygonConcentricCircleMeshGenerator/ring_id_name) and [!param](/Mesh/PolygonConcentricCircleMeshGenerator/sector_id_name), respectively.

For the ring reporting IDs, each annular blocks defined by [!param](/Mesh/PolygonConcentricCircleMeshGenerator/ring_radii) has its own ID values by default.
The default may be overriden by unique ID values by setting [!param](/Mesh/PolygonConcentricCircleMeshGenerator/ring_id_assign_type) as `ring_wise`, if both [!param](/Mesh/PolygonConcentricCircleMeshGenerator/ring_radii) and [!param](/Mesh/PolygonConcentricCircleMeshGenerator/ring_intervals) are specified.

## Other Information

By default, the mesh generated by this object contains a mixture of QUAD4 and TRI3 elements. To be specific, the central region of the mesh consists of triangular elements, whereas the rest of the mesh consists of quadrilateral elements. The users also have an option to generate a purely QUAD4 mesh by setting `quad_center_elements` as true (see [Figure 3](#TRI3_and_QUAD4)). In that case, the $\frac{N}{N+1}$ factor shown in [Figure 3](#TRI3_and_QUAD4) can also be customized using [!param](/Mesh/PolygonConcentricCircleMeshGenerator/center_quad_factor).

!media reactor/meshgenerators/tri_quad.png
      style=display: block;margin-left:auto;margin-right:auto;width:40%;
      id=TRI3_and_QUAD4
      caption=A schematic drawing showing the different meshing algorithms when [!param](/Mesh/PolygonConcentricCircleMeshGenerator/quad_center_elements) is set as `false` and `true`.

When `rings` regions are present, the radii of these `rings` can be auto-adjusted to preserve the meshed annular area (volume) to the true area (volume) by setting [!param](/Mesh/PolygonConcentricCircleMeshGenerator/preserve_volumes) as true.

By default, the azimuthal angles used to discretize the mesh are uniformly spaced in _angle_ on each sector of the polygon. However, uniform spacing of angles leads to non-uniform mesh intervals on the polygon external sides (unless exactly 2 sectors per side are used). However, as a uniformly spaced mesh on the polygon external boundary may facilitate mesh stitching, the user may force a uniform mesh on the polygon external boundary by setting [!param](/Mesh/PolygonConcentricCircleMeshGenerator/uniform_mesh_on_sides) as true.

The default block id numbering starts with 0 at the center region and increments by 1 for each mesh region radially outward. The user may instead set specific block id and name values to rings, background, and duct regions through the use of [!param](/Mesh/PolygonConcentricCircleMeshGenerator/ring_block_ids), [!param](/Mesh/PolygonConcentricCircleMeshGenerator/background_block_ids), [!param](/Mesh/PolygonConcentricCircleMeshGenerator/duct_block_ids), [!param](/Mesh/PolygonConcentricCircleMeshGenerator/ring_block_names), [!param](/Mesh/PolygonConcentricCircleMeshGenerator/background_block_names),  and [!param](/Mesh/PolygonConcentricCircleMeshGenerator/duct_block_names).

The user should be aware that in two cases, the central geometric region is defined as two blocks instead of one:
- When rings are not present, and [!param](/Mesh/PolygonConcentricCircleMeshGenerator/background_intervals) > 1 or a boundary layer is defined in this region
- When rings are present, and the first entry of [!param](/Mesh/PolygonConcentricCircleMeshGenerator/ring_intervals) > 1 or a boundary layer is defined in this region

In both of these cases, the central geometric region will contain both blocks 0 and 1 by default. Any additional usage of block ids or name arrays will require an extra entry for the first geometric region. This extra block definition is needed to accommodate flexibility in defining the central region as either quadrilateral or triangular elements while still stitching properly to the neighboring region. Note that if [!param](/Mesh/PolygonConcentricCircleMeshGenerator/quad_center_elements) is set as `true`, the central geometric region is allowed to have a uniform block id/name. This can be achieved by providing a pair of duplicated block ids/names in the corresponding customized block ids/names input parameter. The user can also provide a single customized block id/name for the central geometric region in this case and the system will duplicate the input for the user.

The external boundary has a default boundary id of 10000. The user may instead set specific boundary id and/or name values through the use of `external_boundary_id` and `external_boundary_name`. Additionally, for each half side of the polygon, an independent boundary id can be optionally generated for side-specific applications by setting [!param](/Mesh/PolygonConcentricCircleMeshGenerator/generate_side_specific_boundaries) as `true`.

### Interface Boundaries

The user can also decide whether the interface boundaries are generated or not.

There are two types of interface boundaries, "inward interface boundaries" and "outward interface boundaries". The "inward" and "outward" here refer to the direction of the boundary's normal vector. As a sideset must be defined on the sides of elements, which belong to one or multiple subdomains, an interface boundary can be defined either on the subdomain immediately inside the interface (i.e., with an "outward" normal vector) or on the subdomain immediately outside the interface (i.e., with an "inward" normal vector).

The user can set [!param](/Mesh/PolygonConcentricCircleMeshGenerator/create_inward_interface_boundaries) and [!param](/Mesh/PolygonConcentricCircleMeshGenerator/create_outward_interface_boundaries) to control which interface boundaries will be created. If generated, the outward interface boundaries will be assigned ids using sequential odd numbers (i.e., 1, 3, 5, 7, ...) from center to periphery, while the inward interface boundaries will be assigned ids using sequential even numbers (i.e., 2, 4, 6, 8, ...) similarly. These ids can be shifted by a user-provided parameter [!param](/Mesh/PolygonConcentricCircleMeshGenerator/interface_boundary_id_shift). The interface boundary names can also be specified through [!param](/Mesh/PolygonConcentricCircleMeshGenerator/inward_interface_boundary_names) and [!param](/Mesh/PolygonConcentricCircleMeshGenerator/outward_interface_boundary_names).

## Example Syntax

!listing modules/reactor/test/tests/meshgenerators/patterned_hex_mesh_generator/patterned_pattern.i block=Mesh/hex_1

!syntax parameters /Mesh/PolygonConcentricCircleMeshGenerator

!syntax inputs /Mesh/PolygonConcentricCircleMeshGenerator

!syntax children /Mesh/PolygonConcentricCircleMeshGenerator
