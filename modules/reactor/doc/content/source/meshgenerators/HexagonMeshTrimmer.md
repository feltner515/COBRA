# HexagonMeshTrimmer

!syntax description /Mesh/HexagonMeshTrimmer

## Overview

The `HexagonMeshTrimmer` object takes the hexagonal mesh generated by [`PatternedHexMeshGenerator`](/PatternedHexMeshGenerator.md) as [!param](/Mesh/HexagonMeshTrimmer/input) and trims off part of the mesh. The input mesh can also be `PatternedHexMeshGenerator`'s output processed by [`PeripheralRingMeshGenerator`](/PeripheralRingMeshGenerator.md) or [`PatternedHexPeripheralModifier`](/PatternedHexPeripheralModifier.md).

Two types of trimming can be performed by `HexagonMeshTrimmer`: +Peripheral Trimming+ and +Through-the-Center Trimming+, which will be introduced separately as follows.

!media meshgenerators/hexagon_trim.png
      style=display: block;margin-left:auto;margin-right:auto;width:60%;
      id=hexagon_trimmer
      caption=A schematic drawing showing different trimming schemes for a hexagonal mesh.

### Peripheral Trimming

Peripheral trimming trims off peripheral region(s) of one or multiple sides of the input hexagonal assembly mesh. To be specific, for each side, half of the unit pin meshes are trimmed off, as shown by the purple lines in [hexagon_trimmer]. Each side of the hexagonal assembly is assigned an index as illustrated in [hexagon_trimmer]. Users can use [!param](/Mesh/HexagonMeshTrimmer/trim_peripheral_region) to set which sides need to be trimmed off (`1`) and which need to be retained (`0`). The setting [!param](/Mesh/HexagonMeshTrimmer/trim_peripheral_region) = "1 1 1 1 1 1"  trims off all the sides (full peripheral trimming) to create a hexagonal assembly mesh with half-pins on each of the external 6 boundaries. Partial peripheral trimming may be employed for practical applications to create peripheral assemblies in a core whose normal interior assembly units contain half-pins on the boundary. The mesh metadata generated by `PatternedHexMeshGenerator` are retained, with `pattern_pitch_meta` updated to take trimming into consideration. The output of this object can be assembled into a patterned lattice using  `PatternedHexMeshGenerator`.

### Center Trimming

Center trimming removes azimuthal sectors from the input hexagonal assembly or core mesh. The mesh may be trimmed along lines of symmetry in the input mesh. Only certain hexagonal meshes are eligible to be trimmed by this object due to imposed symmetries (see Trimmability). Valid hexagonal input meshes may be trimmed at twelve possible center trimming lines, indexed from 0 to 11 as the blue lines shown in [hexagon_trimmer]. Each unit azimuthal sector is 30$^{\circ}$. A practical application of center trimming is to reduce the domain size (and simulation scale) by leveraging symmetry through reflected boundary conditions. Therefore the largest possible output mesh after center trimming contains six consecutive azimuthal sectors (i.e., half of the input mesh), while the smallest possible output mesh has only one azimuthal sector (i.e., one twelfth of the input mesh). This mesh trimmer object RETAINS any sectors which are included between the trimming line defined by [!param](/Mesh/HexagonMeshTrimmer/center_trim_starting_index) to the trimming line defined by [!param](/Mesh/HexagonMeshTrimmer/center_trim_ending_index) swept out in a counterclockwise direction. Other sectors are discarded.

## Trimmability

In general, `HexagonMeshTrimmer` trims meshes generated by `PatternedHexMeshGenerator`. An assembly mesh consisting of patterned pin meshes has both peripheral and center trimmability; whereas a core mesh consisting of patterned assembly meshes only has center trimmability.  Two mesh metadata entries (`peripheral_trimmability` and `center_trimmability`) are created by `PatternedHexMeshGenerator` to tell `HexagonMeshTrimmer` which trimming options are valid. In the absence of these two meta data, `HexagonMeshTrimmer` will throw an incompatible error message.

In addition, `PeripheralRingMeshGenerator`, which applies quadrilateral peripheral cylinder mesh around an assembly or core, retain these two mesh meta data from the input mesh so that valid meshes generated by `PeripheralRingMeshGenerator` may also be trimmed. Similarly, assembly meshes modified by `PatternedHexPeripheralModifier` also have these meta data retained and are thus able to be trimmed by this generator.

## Degenerate Quadrilateral Elements

When trimming a mesh, some elements may be located across the trimming line and thus need to be processed to ensure a smooth trimming boundary. Generic tools such as [`PlaneDeletionGenerator`](/PlaneDeletionGenerator.md) is capable of trimming meshes but leaves a zigzag trimming boundary in the presence of across-trimming-line elements.

To avoid this zig-zag boundary, `HexagonMeshTrimmer` adopts a post-trimming processing algorithm to smooth the trimming boundary. The algorithm moves the nodes of the across-trimming-line elements in the normal direction of the trimming line onto the trimming line. During this procedure, some elements may become zero volume and will be removed. More importantly, after node moving, some quadrilateral elements may have three co-linear vertices on the trimming line, which make the element degenerate. To fix this issue, these degenerate quadrilateral elements are converted into triangular elements. As triangular elements and quadrilateral elements cannot share a single subdomain id/name, new subdomains are created for any affected quadrilateral element subdomains. The subdomain ids of the new subdomains are decided by shifting the original subdomain ids by [!param](/Mesh/HexagonMeshTrimmer/tri_elem_subdomain_shift) (default shift value is the maximum subdomain id of the mesh), while the subdomain names of the new subdomains are created by appending [!param](/Mesh/HexagonMeshTrimmer/tri_elem_subdomain_name_suffix) after the original subdomain names.

## Boundary Assignment

For peripheral trimming, the new boundary formed by the trimming operation is the new external boundary. Therefore, the boundary id defined by [!param](/Mesh/HexagonMeshTrimmer/external_boundary) is assigned to the new boundary. On the other hand, for center trimming, the new boundary formed by the trimming operation is a mirror boundary instead of an external boundary. Hence, the boundary id defined by [!param](/Mesh/HexagonMeshTrimmer/external_boundary) is NOT assigned to the new boundaries.

In addition, users can optionally use [!param](/Mesh/HexagonMeshTrimmer/peripheral_trimming_section_boundary) and [!param](/Mesh/HexagonMeshTrimmer/center_trimming_section_boundary) to assign additional boundary names to the new boundary.

## Example Syntax

!listing modules/reactor/test/tests/meshgenerators/hexagon_mesh_trimmer/patterned_trimmed.i block=Mesh/trim_0

!syntax parameters /Mesh/HexagonMeshTrimmer

!syntax inputs /Mesh/HexagonMeshTrimmer

!syntax children /Mesh/HexagonMeshTrimmer
