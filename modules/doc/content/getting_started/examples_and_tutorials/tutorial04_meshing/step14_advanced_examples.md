# Advanced Meshing Examples

After learning about some of the advanced meshing tools, it is useful to see examples of "what's possible". This chapter contains images and small snippet examples of "what's possible".

## Possible Advanced Reactor Geometries

This tutorial covers the generation of mostly standard geometries, but many reactor designs involve features which were not covered previously. Using the tools covered in this section, MOOSE can generate quite complex geometries illustrated here. The key mesh generators required are listed briefly.

### Molten Salt Reactor Experiment (MSRE) 2D lattice

- [PolygonConcentricCircleMeshGenerator.md] is utilized for producing circular and triangular-shaped regions within the lattice.
- [FillBetweenSidesetsGenerator.md] is employed for generating mesh to fill in the regions between the regions generated by [PolygonConcentricCircleMeshGenerator.md].

!media tutorial04_meshing/adv_ex_2DMSRE.png
       id=tutorial04-adv_ex_2DMSRE
       caption=Molten Salt Reactor Experiment (MSRE) 2D lattice.
       style=width:50%;display:block;margin-left:auto;margin-right:auto;

### KRUSTY heat-pipe cooled microreactor 2D core

- [ParsedCurveGenerator.md] is used for creating the outline of complex shapes before mesh generation.
- [XYDelaunayGenerator.md] is employed for meshing the irregular areas.
- [PeripheralTriangleMeshGenerator.md] is utilized to add layers of triangular mesh onto an existing circular mesh.
- [CircularBoundaryCorrectionGenerator.md] is used to adjust a discretized circle to match the true circle's volume.

!media tutorial04_meshing/adv_ex_2DKRUSTY.png
       id=tutorial04-adv_ex_2DKRUSTY
       caption=KRUSTY heat pipe-cooled microreactor 2D core.
       style=width:50%;display:block;margin-left:auto;margin-right:auto;

### Modular High Temperature Gas Cooled Reactor (MHTGR)

- [PolygonConcentricCircleMeshGenerator.md] and [PatternedHexMeshGenerator.md] generate pins and assemblies
- [XYDelaunayGenerator.md] generates control rod holes and reflector assemblies
- [StitchedMeshGenerator.md] merges control rod holes with fuel and reflector assemblies
- [HexagonConcentricCircleAdaptiveBoundaryMeshGenerator.md] generates ducts for reflector assembly that can be stitched with other assembles.
- [PatternedHexMeshGenerator.md] generates a lattice of fuel and reflector assemblies into the core
- [PeripheralRingMeshGenerator.md] adds a circular boundary surrounding the core
- [AdvancedExtruderGenerator.md] performs 2D to 3D extrusion for the core
- [DepletionIDGenerator.md] sets up assembly-wise depletion zones

!media tutorial04_meshing/adv_ex_mhgtr.png
       id=tutorial04-adv_ex_mhgtr
       caption=MHTGR 2D mesh.
       style=width:50%;display:block;margin-left:auto;margin-right:auto;

!media tutorial04_meshing/adv_ex_mhtgrzoom.png
       id=tutorial04-adv_ex_mhtgrzoom
       caption=MHTGR 2D mesh, zoomed in.
       style=width:50%;display:block;margin-left:auto;margin-right:auto;

### 2D Pebble Bed Reactor with Streamlines

- [FillBetweenPointVectorsGenerator.md] generates pebble bed streamlines
- [CartesianMeshGenerator.md] and [FillBetweenSidesetsGenerator.md] generates rectangular meshes and trapezoid meshes
- [StitchedMeshGenerator.md] merges core components
- [CombinerGenerator.md] combines outer walls of core barrel and RPV

!media tutorial04_meshing/adv_ex_PBRPronghornGriffin.png
       id=tutorial04-adv_ex_PBRPronghornGriffin
       caption=2D generic pebble bed reactor meshes for Pronghorn (left) and Griffin (right) with flow streamlines from top inlet to bottom conical outlet.
       style=width:50%;display:block;margin-left:auto;margin-right:auto;

## Boundary Layers and Biasing

During the mesh refinement process, it is common to require finer discretizations in one region and coarser discretizations in another region. The boundary layer and biasing features available in the Reactor Module allow the user to refine the mesh in areas of interest for the physics problem at hand.

### Mesh Biasing

Mesh biasing applies non-uniform meshing subintervals within a specific region. For example, a fuel pin may generally require an axial meshing size of 5 cm, but at the very top and bottom of the active fuel zone where the power shape has a larger gradient, the user may require finer grids. This is possible using mesh biasing parameters available in [AdvancedExtruderGenerator.md].

!media tutorial04_meshing/aeg_ax_bias.png
       id=tutorial04-aeg_ax_bias
       caption=A 3D mesh generated by extruding a 2D square mesh using [AdvancedExtruderGenerator.md] with axial biasing in the top (green) and bottom (white) axial blocks.
       style=width:50%;display:block;margin-left:auto;margin-right:auto;

!listing adv_examples/ax_bias.i
         id=tutorial04-ax_bias.i
         caption=Axial mesh biasing example.
         block=Mesh

Similarly, the user may want to radially bias the mesh where solution gradients are known to be high, for example at the edge of a fuel pin or control rod. This is possible using mesh biasing parameters in [PolygonConcentricCircleMeshGenerator.md] as well as [PeripheralRingMeshGenerator.md].

!media tutorial04_meshing/pccmg_rad_bias.png
       id=tutorial04-pccmg_rad_bias
       caption=A hexagonal pin mesh generated by [PolygonConcentricCircleMeshGenerator.md] with radial biasing in both the outmost ring block (red) and background block (blue).
       style=width:50%;display:block;margin-left:auto;margin-right:auto;

!listing adv_examples/rad_bias_pccmg.i
         id=tutorial04-rad_bias_pccmg.i
         caption=Radial mesh biasing example.
         block=Mesh

!media tutorial04_meshing/prmg_rad_bias.png
       id=tutorial04-prmg_rad_bias
       caption=A peripheral ring mesh with radial biasing added to a hexagonal pin mesh.
       style=width:50%;display:block;margin-left:auto;margin-right:auto;

!listing adv_examples/rad_bias_prmg.i
         id=tutorial04-rad_bias_prmg.i
         caption=Peripheral ring radial mesh biasing example.
         block=Mesh

### Mesh Boundary Layers

Boundary layers are commonly needed in thermal-hydraulic applications, where the thickness of the mesh near a wall must be a certain size, uniformly, regardless of the width of the meshed region. Boundary layers are possible using [PolygonConcentricCircleMeshGenerator.md] and [PeripheralRingMeshGenerator.md].

!media tutorial04_meshing/pccmg_bdry_layer.png
       id=tutorial04-pccmg_bdry_layer
       caption=A hexagonal pin mesh generated by [PolygonConcentricCircleMeshGenerator.md] with boundary layers created in both the outmost ring block (outer boundary layer, red) and background block (inner boundary layer, blue).
       style=width:50%;display:block;margin-left:auto;margin-right:auto;

!listing adv_examples/bdry_layer_pccmg.i
         id=tutorial04-bdry_layer_pccmg.i
         caption=[PolygonConcentricCircleMeshGenerator.md] boundary layer example.
         block=Mesh

## Stitching Assemblies with Different Pin Numbers

Typical reactor cores are comprised of many different assembly types, each with different numbers of pins. When the pins are explicitly meshed, the number of nodes on the assembly boundary is determined by a combination of the number pins as well as the pin azimuthal discretization. It is difficult to find a reasonably low azimuthal discretization for each assembly such that all assemblies have the same number of nodes on their boundaries.

The best approach for this situation is to use [PatternedHexPeripheralModifier.md] to strip the outermost layer off each assembly and replace it with a transition layer with a set number of nodes on the outermost boundary. Doing this to each assembly will ensure that all assemblies have the same number of boundary nodes and can be easily stitched. An example follows.

!media tutorial04_meshing/adv_ex_assembies_with_different_pin_nums.png
       id=tutorial04-adv_ex_assembies_with_different_pin_nums
       caption=[PatternedHexPeripheralModifier.md] is used to adjust the boundary node count on each assembly to be consistent with each other and therefore stitchable.
       style=width:50%;display:block;margin-left:auto;margin-right:auto;

!listing modules/reactor/test/tests/meshgenerators/patterned_hex_peripheral_modifier/patterned.i
         id=tutorial04-patterned.i
         caption=Assemblies with different pin numbers example.
         block=Mesh

## Oversized Pin

Some assemblies contain an oversized pin which intrudes on neighboring unit pin cells. Here, we describe one possible approach to mesh this situation.

First, define the regular small fuel pins and place them into the assembly as a full lattice. Next, delete the dummy unit pin cells, making sure to assign the newly created hole boundary a specific boundary name.

Separately, the oversized pin should be defined as its own object, remembering to remove the background region which is created by default in [PolygonConcentricCircleMeshGenerator.md]. This mesh will serve as the "hole" for [XYDelaunayGenerator.md].

Finally, [XYDelaunayGenerator.md] is used to mesh the regions between the assembly (with deleted dummies) and the oversized pin. This is done by giving [XYDelaunayGenerator.md] the assembly mesh and the oversized pin mesh and specifying via input parameters that the region between the assembly mesh and the oversized pin mesh should be triangulated. The oversized pin mesh is placed into the geometry at this time as well.

!media tutorial04_meshing/adv_ex_oversized_pin.png
       id=tutorial04-adv_ex_oversized_pin
       caption=An assembly mesh with an oversized pin in the center. The mesh is generated by modifying the output of [PatternedHexMeshGenerator.md] by replacing the central region with a mesh generated by [XYDelaunayGenerator.md].
       style=width:50%;display:block;margin-left:auto;margin-right:auto;

!listing adv_examples/oversize.i
         id=tutorial04-oversize.i
         caption=Oversized pin example.
         block=Mesh

## Filling Between Curves using "FillBetweenSidesetsGenerator"

The MSRE 2D lattice case pictured in [tutorial04-adv_ex_fbsg](left) was constructed using the [FillBetweenSidesetsGenerator.md] to connect "quarter" circular pins, as shown in [tutorial04-adv_ex_fbsg](right). First, [ConcentricCircleMeshGenerator.md] (a predecessor of [PolygonConcentricCircleMeshGenerator.md] which has a different set of input options and works only for square pin cells) was used to create two quarter pins. Each quarter pin mesh initially contains two duplicate "quarter pin" shaped blocks, and then one of the duplicate blocks is deleted in order to be able to label the sideset on the curved boundary as `curve_1` and `curve_2` in the two pins, respectively. This is the simplest possible procedure with the current [Mesh system](syntax/Mesh/index.md) in MOOSE, but could be improved in the future. These two pins were translated in space to move them apart from each other, and then [FillBetweenSidesetsGenerator.md] was used to mesh the area between `curve_1` and `curve_2`.

!media tutorial04_meshing/adv_ex_fbsg.png
       id=tutorial04-adv_ex_fbsg
       caption=An example of using [FillBetweenSidesetsGenerator.md] to connect quarter circular-shapedsquare meshes.
       style=width:50%;display:block;margin-left:auto;margin-right:auto;

!listing adv_examples/quarter_circle_connect.i
         id=tutorial04-quarter_circle_connect.i
         caption=[FillBetweenSidesetsGenerator.md] example.
         block=Mesh/connect_two_circles

## Triangulation of Odd-Shaped Regions Using "ParsedCurveGenerator" and "XYDelaunayGenerator"

This example demonstrates how to place a control drum object in an arbitrary position in a core that may overlap subdomain boundaries.

First, the center assembly is created using regular pins and procedures.

!media tutorial04_meshing/adv_ex_pcg_xy_patterned_pins.png
       id=tutorial04-adv_ex_pcg_xy_patterned_pins
       caption=An example of using [XYDelaunayGenerator.md] with curve meshes generated by [ParsedCurveGenerator.md], patterned pins.
       style=width:50%;display:block;margin-left:auto;margin-right:auto;

!listing adv_examples/pcg_xyd.i
         id=tutorial04-adv_ex_pcg_xy_patterned_pins_lst
         caption=An example of using [XYDelaunayGenerator.md] with curve meshes generated by [ParsedCurveGenerator.md], patterned pins.
         block=Mesh/hex_1 Mesh/pattern

Next, two circular peripheral regions are added using [PeripheralTriangleMeshGenerator.md] (yellow, purple zones).

!media tutorial04_meshing/adv_ex_pcg_xy_patterned_pins_with_rings.png
       id=tutorial04-adv_ex_pcg_xy_patterned_pins_with_rings
       caption=An example of using [XYDelaunayGenerator.md] with curve meshes generated by [ParsedCurveGenerator.md], patterned pins with rings.
       style=width:50%;display:block;margin-left:auto;margin-right:auto;

!listing adv_examples/pcg_xyd.i
         id=tutorial04-adv_ex_pcg_xy_patterned_pins_with_rings_lst
         caption=An example of using [XYDelaunayGenerator.md] with curve meshes generated by [ParsedCurveGenerator.md], patterned pins with rings.
         block=Mesh/tmg1 Mesh/tmg2

Next, the complex boundary shape which is the outer edge of the light blue zone is defined using [ParsedCurveGenerator.md] and analytic piecewise functions. The interior of this boundary is then filled in, including the center assembly, using [XYDelaunayGenerator.md].

!media tutorial04_meshing/adv_ex_pcg_xy_patterned_pins_with_irregular_peripheral_region.png
       id=tutorial04-adv_ex_pcg_xy_patterned_pins_with_irregular_peripheral_region
       caption=An example of using [XYDelaunayGenerator.md] with curve meshes generated by [ParsedCurveGenerator.md], patterned pins with irregular peripheral region.
       style=width:50%;display:block;margin-left:auto;margin-right:auto;

!listing adv_examples/pcg_xyd.i
         id=tutorial04-adv_ex_pcg_xy_patterned_pins_with_irregular_peripheral_region_lst
         caption=An example of using [XYDelaunayGenerator.md] with curve meshes generated by [ParsedCurveGenerator.md], patterned pins with irregular peripheral region.
         block=Mesh/pcg1 Mesh/xydg1

The control drum object is defined including the absorber arc using [PolygonConcentricCircleMeshGenerator.md] and [AzimuthalBlockSplitGenerator.md], then the background region of the control drum is deleted to leave only the circular part. This mesh is then translated into the desired position of the final mesh using [TransformGenerator.md]. The small red pin is defined similarly (not requiring [AzimuthalBlockSplitGenerator.md]).

!media tutorial04_meshing/adv_ex_pcg_xy_three_holes_for_xyd.png
       id=tutorial04-adv_ex_pcg_xy_three_holes_for_xyd
       caption=An example of using [XYDelaunayGenerator.md] with curve meshes generated by [ParsedCurveGenerator.md], three holes for XYDelaunayGenerator.
       style=width:50%;display:block;margin-left:auto;margin-right:auto;

!listing adv_examples/pcg_xyd.i
         id=tutorial04-adv_ex_pcg_xy_three_holes_for_xyd_lst
         caption=An example of using [XYDelaunayGenerator.md] with curve meshes generated by [ParsedCurveGenerator.md], three holes for XYDelaunayGenerator.
         block=Mesh/cd Mesh/cd_azi_define Mesh/cd_bd Mesh/cd_translate Mesh/outer_pin Mesh/op_bd Mesh/op_translate

The outer boundary of the dark blue zone is then generated using [ParsedCurveGenerator.md] and analytical functions. [XYDelaunayGenerator.md] is again used to fill the dark blue regions, keeping the light blue region and assembly, control drum, and small pin.

!media tutorial04_meshing/adv_ex_pcg_xy_second_xyd.png
       id=tutorial04-adv_ex_pcg_xy_second_xyd
       caption=An example of using [XYDelaunayGenerator.md] with curve meshes generated by [ParsedCurveGenerator.md], second XYDelaunayGenerator.
       style=width:50%;display:block;margin-left:auto;margin-right:auto;

!listing adv_examples/pcg_xyd.i
         id=tutorial04-adv_ex_pcg_xy_second_xyd_lst
         caption=An example of using [XYDelaunayGenerator.md] with curve meshes generated by [ParsedCurveGenerator.md], second XYDelaunayGenerator.
         block=Mesh/pcg2 Mesh/xydg2

Finally, a circular peripheral region is added at the end using [PeripheralTriangleMeshGenerator.md] (yellow).

!media tutorial04_meshing/adv_ex_pcg_and_xyd.png
       id=tutorial04-adv_ex_pcg_and_xyd
       caption=An example of using [XYDelaunayGenerator.md] with curve meshes generated by [ParsedCurveGenerator.md], complete.
       style=width:50%;display:block;margin-left:auto;margin-right:auto;

!listing adv_examples/pcg_xyd.i
         id=tutorial04-pcg_xyd.i
         caption=An example of using [XYDelaunayGenerator.md] with curve meshes generated by [ParsedCurveGenerator.md], complete.
         block=Mesh/tmg3

!content pagination previous=tutorial04_meshing/step13_advanced_tools.md
